<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head') %>
<body>
    <%- include('./partials/nav') %> 
    <div class="container">
        <h2><%= folder.name %></h2>
        <% if (permission === "write") { %>

            <a href="/f/<%= folder.id %>/edit">Edit</a>
            <button type="button" class="share-button" onclick="shareFolder()">Share</button>
        <% } %>


        <h3>Files:</h3>

        <div class="file-grid">
            <% if(folder.files.length === 0) { %>
                <p>No files uploaded yet.</p>
            <% } %>
            <% folder.files.forEach( file => { %>
                <div class="file-card card-link-wrapper">
                    <a href="<%= fileUrl(file) %>" class="card-link"> Open </a>
                 
                        <a href="<%= fileUrl(file) %>" class="card-title">
                         <%= file.originalName %>
                        </a>

                      <form action="<%= deleteFileUrl(file) %>" method="post" onsubmit="return confirm('Delete this file?');">
                          <button type="submit" class="delete">Delete</button>
                      </form>
                 
                </div>
            
            <% }) %>
        </div>

        <% if (permission === "write") { %>
            <a href="%= uploadUrl %>">Upload new file</a>
            <form action="<%= deleteFolderUrl %>" method="post" onsubmit="return confirm('Delete this folder?');">
                <button type="submit">Delete Folder</button>
            </form>
        <% } %>


    </div>
    
    <script>
        function shareFolder(){
            const shareUrl = window.location.origin + "/share/f/<%= folder.token %>";
            navigator.clipboard.writeText(shareUrl)
            .then(() => {
                alert("Link copied to clipboard!");
            })
            .catch(err => {
                console.error("Failed to copy:", err);
            });
        }
    </script>


</body>
</html>